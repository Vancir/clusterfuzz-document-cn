<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Build pipeline - ClusterFuzz</title> <link rel="shortcut icon" href="/clusterfuzz-document-cn/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/clusterfuzz-document-cn/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-88024544-3"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-88024544-3'); </script> <script type="text/javascript" src="/clusterfuzz-document-cn/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/clusterfuzz-document-cn/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Build pipeline | ClusterFuzz</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Build pipeline" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation for ClusterFuzz" /> <meta property="og:description" content="Documentation for ClusterFuzz" /> <link rel="canonical" href="/clusterfuzz-document-cn/production-setup/build-pipeline/" /> <meta property="og:url" content="/clusterfuzz-document-cn/production-setup/build-pipeline/" /> <meta property="og:site_name" content="ClusterFuzz" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Build pipeline" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"Build pipeline","description":"Documentation for ClusterFuzz","url":"/clusterfuzz-document-cn/production-setup/build-pipeline/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/clusterfuzz-document-cn/" class="site-title lh-tight"> ClusterFuzz </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/clusterfuzz-document-cn/" class="nav-list-link">ClusterFuzz</a><ul class="nav-list "><li class="nav-list-item "><a href="/clusterfuzz-document-cn/architecture/" class="nav-list-link">Architecture</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/clusterfuzz-document-cn/getting-started/" class="nav-list-link">Getting started</a><ul class="nav-list "><li class="nav-list-item "><a href="/clusterfuzz-document-cn/getting-started/prerequisites/" class="nav-list-link">Prerequisites</a></li><li class="nav-list-item "><a href="/clusterfuzz-document-cn/getting-started/local-instance/" class="nav-list-link">Running a local instance</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/clusterfuzz-document-cn/setting-up-fuzzing/" class="nav-list-link">Setting up fuzzing</a><ul class="nav-list "><li class="nav-list-item "><a href="/clusterfuzz-document-cn/setting-up-fuzzing/libfuzzer-and-afl/" class="nav-list-link">libFuzzer and AFL++</a></li><li class="nav-list-item "><a href="/clusterfuzz-document-cn/setting-up-fuzzing/blackbox-fuzzing/" class="nav-list-link">Blackbox fuzzing</a></li><li class="nav-list-item "><a href="/clusterfuzz-document-cn/setting-up-fuzzing/heartbleed-example/" class="nav-list-link">Heartbleed example</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/clusterfuzz-document-cn/production-setup/" class="nav-list-link">Production setup</a><ul class="nav-list "><li class="nav-list-item "><a href="/clusterfuzz-document-cn/production-setup/clusterfuzz/" class="nav-list-link">ClusterFuzz</a></li><li class="nav-list-item active"><a href="/clusterfuzz-document-cn/production-setup/build-pipeline/" class="nav-list-link active">Build pipeline</a></li><li class="nav-list-item "><a href="/clusterfuzz-document-cn/production-setup/setting-up-fuzzing-job/" class="nav-list-link">Setting up a fuzzing job</a></li><li class="nav-list-item "><a href="/clusterfuzz-document-cn/production-setup/setting-up-bots/" class="nav-list-link">Setting up bots</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/clusterfuzz-document-cn/using-clusterfuzz/" class="nav-list-link">Using ClusterFuzz</a><ul class="nav-list "><li class="nav-list-item "><a href="/clusterfuzz-document-cn/using-clusterfuzz/ui-overview/" class="nav-list-link">UI overview</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/clusterfuzz-document-cn/using-clusterfuzz/workflows/" class="nav-list-link">Workflows</a><ul class="nav-list"><li class="nav-list-item "> <a href="/clusterfuzz-document-cn/using-clusterfuzz/workflows/triaging-new-crashes/" class="nav-list-link">Triaging new crashes</a> </li><li class="nav-list-item "> <a href="/clusterfuzz-document-cn/using-clusterfuzz/workflows/fixing-a-bug/" class="nav-list-link">Fixing a bug</a> </li><li class="nav-list-item "> <a href="/clusterfuzz-document-cn/using-clusterfuzz/workflows/analyzing-fuzzing-performance/" class="nav-list-link">Analyzing fuzzer performance</a> </li><li class="nav-list-item "> <a href="/clusterfuzz-document-cn/using-clusterfuzz/workflows/uploading-a-testcase/" class="nav-list-link">Uploading a testcase</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/clusterfuzz-document-cn/using-clusterfuzz/advanced/" class="nav-list-link">Advanced features</a><ul class="nav-list"><li class="nav-list-item "> <a href="/clusterfuzz-document-cn/using-clusterfuzz/advanced/access-control/" class="nav-list-link">Access control</a> </li><li class="nav-list-item "> <a href="/clusterfuzz-document-cn/using-clusterfuzz/advanced/code-coverage/" class="nav-list-link">Code coverage</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/clusterfuzz-document-cn/contributing-code/" class="nav-list-link">Contributing code</a><ul class="nav-list "><li class="nav-list-item "><a href="/clusterfuzz-document-cn/contributing-code/source-code/" class="nav-list-link">Source code</a></li><li class="nav-list-item "><a href="/clusterfuzz-document-cn/contributing-code/running-unit-tests/" class="nav-list-link">Running unit tests</a></li><li class="nav-list-item "><a href="/clusterfuzz-document-cn/contributing-code/staging-changes/" class="nav-list-link">Staging changes</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/clusterfuzz-document-cn/reference/" class="nav-list-link">Reference</a><ul class="nav-list "><li class="nav-list-item "><a href="/clusterfuzz-document-cn/reference/glossary/" class="nav-list-link">Glossary</a></li><li class="nav-list-item "><a href="/clusterfuzz-document-cn/reference/coverage-guided-vs-blackbox/" class="nav-list-link">Coverage guided vs blackbox fuzzing</a></li><li class="nav-list-item "><a href="/clusterfuzz-document-cn/reference/job-definition/" class="nav-list-link">Job definition</a></li><li class="nav-list-item "><a href="/clusterfuzz-document-cn/reference/faq/" class="nav-list-link">FAQ</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search ClusterFuzz" aria-label="Search ClusterFuzz" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/google/clusterfuzz" class="site-button" > ClusterFuzz on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/clusterfuzz-document-cn/production-setup/">Production setup</a></li> <li class="breadcrumb-nav-list-item"><span>Build pipeline</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="build-pipeline"> <a href="#build-pipeline" class="anchor-heading" aria-labelledby="build-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Build pipeline </h1> <p>This document describes the requirements and recommendations for setting up a continuous build pipeline for a project using ClusterFuzz.</p> <ul id="markdown-toc"> <li><a href="#build-pipeline" id="markdown-toc-build-pipeline">Build pipeline</a> <ul> <li><a href="#why-do-you-need-a-build-pipeline" id="markdown-toc-why-do-you-need-a-build-pipeline">Why do you need a build pipeline?</a></li> <li><a href="#setting-up-a-builder" id="markdown-toc-setting-up-a-builder">Setting up a builder</a></li> <li><a href="#sanitizers" id="markdown-toc-sanitizers">Sanitizers</a></li> <li><a href="#providing-the-builds-to-clusterfuzz" id="markdown-toc-providing-the-builds-to-clusterfuzz">Providing the builds to ClusterFuzz</a></li> <li><a href="#providing-revisions-for-the-build-dependencies" id="markdown-toc-providing-revisions-for-the-build-dependencies">Providing revisions for the build dependencies</a></li> <li><a href="#other-artifacts-and-runtime-dependencies" id="markdown-toc-other-artifacts-and-runtime-dependencies">Other artifacts and runtime dependencies</a></li> <li><a href="#build-pipeline-solutions" id="markdown-toc-build-pipeline-solutions">Build pipeline solutions</a></li> </ul> </li> </ul><hr /> <h2 id="why-do-you-need-a-build-pipeline"> <a href="#why-do-you-need-a-build-pipeline" class="anchor-heading" aria-labelledby="why-do-you-need-a-build-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Why do you need a build pipeline? </h2> <p>Fuzzing is a software testing technique which works out best if done continuously. As your target projects evolve, ClusterFuzz needs to be able to fuzz the most recent versions of them. Having a continuously running build pipeline allows ClusterFuzz to identify revisions when a regression was introduced as well as detect bug fixes and the corresponding revisions.</p> <h2 id="setting-up-a-builder"> <a href="#setting-up-a-builder" class="anchor-heading" aria-labelledby="setting-up-a-builder"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setting up a builder </h2> <p>ClusterFuzz does not provide any build infrastructure, as build systems can be very different across projects. If you have existing CI infrastructure, very likely it can be used for providing builds to ClusterFuzz.</p> <h2 id="sanitizers"> <a href="#sanitizers" class="anchor-heading" aria-labelledby="sanitizers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sanitizers </h2> <p>As described in the <a href="/clusterfuzz-document-cn/setting-up-fuzzing/">Setting up fuzzing</a> docs, your builds need to be instrumented with a <a href="/clusterfuzz-document-cn/reference/glossary/#sanitizer">sanitizer</a>. See the individual links for each sanitizer <a href="/clusterfuzz-document-cn/reference/glossary/#sanitizer">here</a> for instructions on how to use them.</p> <h2 id="providing-the-builds-to-clusterfuzz"> <a href="#providing-the-builds-to-clusterfuzz" class="anchor-heading" aria-labelledby="providing-the-builds-to-clusterfuzz"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Providing the builds to ClusterFuzz </h2> <ul> <li>The builds should be packed into zip or tar archives and uploaded to a <a href="https://cloud.google.com/storage/docs/creating-buckets">GCS bucket</a>. Uploading can be done via <a href="https://cloud.google.com/storage/docs/gsutil">gsutil tool</a> or by using <a href="https://cloud.google.com/storage/docs/access-control/signed-urls">signed URLs</a>.</li> <li>The archive name should be of <code class="language-plaintext highlighter-rouge">any-name-([0-9]+).zip</code> format, where <code class="language-plaintext highlighter-rouge">([0-9]+)</code> stands for a revision number such as SVN commit position, a timestamp (e.g. <code class="language-plaintext highlighter-rouge">YYYYMMDDHHMM</code>), or another build number which <strong>increases</strong> with every build. Other than <code class="language-plaintext highlighter-rouge">zip</code>, we support <a href="https://en.wikipedia.org/wiki/Tar_(computing)#Suffixes_for_compressed_files">tar extensions</a> as well.</li> <li>When <a href="/clusterfuzz-document-cn/production-setup/setting-up-fuzzing-job/">setting up a fuzzing job</a>, specify <code class="language-plaintext highlighter-rouge">RELEASE_BUILD_BUCKET_PATH</code> env variable to point to the builds location, e.g. <code class="language-plaintext highlighter-rouge">gs://bucket-name/subdirectory/any-name-([0-9]+).zip</code>.</li> </ul> <h2 id="providing-revisions-for-the-build-dependencies"> <a href="#providing-revisions-for-the-build-dependencies" class="anchor-heading" aria-labelledby="providing-revisions-for-the-build-dependencies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Providing revisions for the build dependencies </h2> <p>ClusterFuzz is able to detect <em>regression</em> and <em>fixed</em> revision ranges not only for your target project, but for its dependencies as well. The only requirement is to provide a <code class="language-plaintext highlighter-rouge">.srcmap.json</code> file alongside the build archive. The filename should be the same as the build archive name, but with <code class="language-plaintext highlighter-rouge">.srcmap.json</code> suffix instead of <code class="language-plaintext highlighter-rouge">.zip</code>/<code class="language-plaintext highlighter-rouge">.tar*</code> (i.e. <code class="language-plaintext highlighter-rouge">any-name-([0-9]+).srcmap.json</code>).</p> <p>When <a href="/clusterfuzz-document-cn/production-setup/setting-up-fuzzing-job/">setting up a fuzzing job</a>, specify <code class="language-plaintext highlighter-rouge">REVISION_VARS_URL</code> env variable to point to srcmap files location, e.g. <code class="language-plaintext highlighter-rouge">gs://bucket-name/subdirectory/any-name-([0-9]+).srcmap.json</code>.</p> <p>These srcmap files have the following format:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"/path/to/library"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"type_of_version_control_system"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"repository_url"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"rev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"revision_identifier"</span><span class="p">,</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">any</span><span class="w"> </span><span class="err">number</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">projects</span><span class="w"> </span><span class="err">enumerated</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">format</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>An example of <code class="language-plaintext highlighter-rouge">.srcmap.json</code> for a libpng build:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"/src/libpng"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"git"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/glennrp/libpng.git"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"rev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eddf9023206dc40974c26f589ee2ad63a4227a1e"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"/src/zlib"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"git"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/madler/zlib.git"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"rev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cacf7f1d4e3d44d871b605da3b647f07d718623f"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"/src/libfuzzer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"svn"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://llvm.org/svn/llvm-project/compiler-rt/trunk/lib/fuzzer"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"rev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"350185"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h2 id="other-artifacts-and-runtime-dependencies"> <a href="#other-artifacts-and-runtime-dependencies" class="anchor-heading" aria-labelledby="other-artifacts-and-runtime-dependencies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Other artifacts and runtime dependencies </h2> <p>If your target program requires any additional runtime dependencies or artifacts such as <a href="/clusterfuzz-document-cn/setting-up-fuzzing/libfuzzer_and_afl/#seed-corpus">seed corpus</a> or a <a href="/clusterfuzz-document-cn/setting-up-fuzzing/libfuzzer_and_afl/#dictionaries">dictionary</a> for <a href="/clusterfuzz-document-cn/setting-up-fuzzing/libfuzzer_and_afl/">libFuzzer or AFL</a>, all these files should be placed in the same directory as the target executable and be included in the build archive.</p> <h2 id="build-pipeline-solutions"> <a href="#build-pipeline-solutions" class="anchor-heading" aria-labelledby="build-pipeline-solutions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Build pipeline solutions </h2> <p>Most of the Continuous Integration systems can be used for providing builds to ClusterFuzz. Examples include <a href="https://cloud.google.com/cloud-build/docs/">Google Cloud Build</a>, <a href="https://jenkins.io/">Jenkins</a>, and others.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
